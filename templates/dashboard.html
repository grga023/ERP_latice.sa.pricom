{% extends "base.html" %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="page-header mb-4">
  <h1 style="font-size: 3rem; font-weight: 800; margin-bottom: 0.5rem; color: #1a1a1a;">ğŸ“Š Dashboard</h1>
  <p style="color: #4a4a4a; font-size: 1.2rem;">Business overview and quick actions</p>
</div>

<!-- Stats Cards -->
<div class="stats-grid mb-5 fade-in">
  <div class="stat-card">
    <div class="stat-icon">ğŸ“‹</div>
    <div class="stat-value" id="stat-nove">0</div>
    <div class="stat-label">New Orders</div>
  </div>
  <div class="stat-card">
    <div class="stat-icon">ğŸšš</div>
    <div class="stat-value" id="stat-dostava">0</div>
    <div class="stat-label">For Delivery</div>
  </div>
  <div class="stat-card">
    <div class="stat-icon">âœ…</div>
    <div class="stat-value" id="stat-realizovano">0</div>
    <div class="stat-label">Completed</div>
  </div>
  <div class="stat-card">
    <div class="stat-icon">ğŸ’°</div>
    <div class="stat-value" id="stat-zarada">0 RSD</div>
    <div class="stat-label">Total Revenue</div>
  </div>
</div>

<!-- Quick Action Cards -->
<div class="page-header mb-3">
  <h2 style="font-size: 1.75rem; font-weight: 700; color: var(--dark-gray);">Quick Actions</h2>
</div>

<div class="grid grid-3 fade-in">
  <a href="/create" class="card text-center" style="text-decoration: none; color: inherit; transition: transform 0.3s ease;">
    <div style="font-size: 3rem; margin-bottom: 1rem;">â•</div>
    <h3 class="gradient-text" style="margin-bottom: 0.5rem; font-size: 1.5rem;">New Order</h3>
    <p style="color: var(--gray); margin: 0;">Create a new order</p>
  </a>

  <a href="/new-orders" class="card text-center" style="text-decoration: none; color: inherit; transition: transform 0.3s ease;">
    <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ“‹</div>
    <h3 class="gradient-text" style="margin-bottom: 0.5rem; font-size: 1.5rem;">Orders</h3>
    <p style="color: var(--gray); margin: 0;">View all orders</p>
  </a>

  <a href="/for-delivery" class="card text-center" style="text-decoration: none; color: inherit; transition: transform 0.3s ease;">
    <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸšš</div>
    <h3 class="gradient-text" style="margin-bottom: 0.5rem; font-size: 1.5rem;">For Delivery</h3>
    <p style="color: var(--gray); margin: 0;">View delivery orders</p>
  </a>

  <a href="/realized" class="card text-center" style="text-decoration: none; color: inherit; transition: transform 0.3s ease;">
    <div style="font-size: 3rem; margin-bottom: 1rem;">âœ…</div>
    <h3 class="gradient-text" style="margin-bottom: 0.5rem; font-size: 1.5rem;">Completed</h3>
    <p style="color: var(--gray); margin: 0;">History of completed orders</p>
  </a>

  <a href="/inventory" class="card text-center" style="text-decoration: none; color: inherit; transition: transform 0.3s ease;">
    <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ“¦</div>
    <h3 class="gradient-text" style="margin-bottom: 0.5rem; font-size: 1.5rem;">Inventory</h3>
    <p style="color: var(--gray); margin: 0;">Manage stock</p>
  </a>

  <a href="/settings" class="card text-center" style="text-decoration: none; color: inherit; transition: transform 0.3s ease;">
    <div style="font-size: 3rem; margin-bottom: 1rem;">âš™ï¸</div>
    <h3 class="gradient-text" style="margin-bottom: 0.5rem; font-size: 1.5rem;">Settings</h3>
    <p style="color: var(--gray); margin: 0;">Configure system</p>
  </a>
</div>

{% endblock %}

{% block scripts %}
<script>
// Load statistics
async function loadStats() {
  try {
    // Get new orders count
    const noveRes = await fetch('/api/orders/new');
    const nove = await noveRes.json();
    document.getElementById('stat-nove').textContent = nove.length;

    // Get for delivery count
    const dostavaRes = await fetch('/api/orders/for_delivery');
    const dostava = await dostavaRes.json();
    document.getElementById('stat-dostava').textContent = dostava.length;

    // Get realized orders and calculate total
    const realizovanoRes = await fetch('/api/orders/realized');
    const realizovano = await realizovanoRes.json();
    document.getElementById('stat-realizovano').textContent = realizovano.length;

    // Calculate total revenue
    let totalRevenue = 0;
    realizovano.forEach(order => {
      totalRevenue += parseFloat(order.price) || 0;
    });
    document.getElementById('stat-zarada').textContent = totalRevenue.toLocaleString('sr-RS') + ' RSD';

  } catch (err) {
    console.error('Error loading stats:', err);
  }
}

// Add hover effect to cards
document.querySelectorAll('.card').forEach(card => {
  card.addEventListener('mouseenter', function() {
    this.style.transform = 'translateY(-5px)';
  });
  card.addEventListener('mouseleave', function() {
    this.style.transform = 'translateY(0)';
  });
});

// Load stats on page load
loadStats();

// Refresh stats every 30 seconds
setInterval(loadStats, 30000);
</script>
{% endblock %}
